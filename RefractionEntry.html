<!DOCTYPE html>
<html>

<head>
  <title>Refraction Entry</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=0.8, maximum-scale=1.1">
  <link rel="icon" href="https://www.iconoptical.com/wp-content/uploads/2018/02/cropped-logo-32x32.jpg">
  <link href="CSS/bootstrap.min.css" rel="stylesheet">
  <script src="JS/jquery-3.7.1.min.js"></script>
  <style>
    body {
      margin: auto;
      padding: 0;
      /* max-width: 1000px; */
      height: 100%;
      overflow: hidden;
    }

    @media only screen and (min-width: 1200px) {
      body {
        aspect-ratio: 4/3;
      }
    }

    .f-lg {
      font-weight: 600;
      font-size: 28px;
    }

    .f-picker-normal {
      font-weight: 600;
      font-size: 24px;
    }

    .f-picker-lg {
      font-weight: 600;
      font-size: 28px;
    }

    .fixed-width {}


    .rx-group-header {
      font-weight: 600;
      font-size: 20px;
    }

    .rx-table input {
      text-align: center;
      font-weight: 600;
      font-size: 22px;
      padding: 10px 0;
      margin-bottom: 4px;
    }

    .rx-entry-sph {}

    .rx-entry-cyl {}

    .rx-entry-axis {}

    .rx-entry-add {}

    .rx-entry-h {}

    .rx-entry-va {}

    .rx-entry-pd {}


    .rx-table {
      /* max-width: 600px ; */
      /* width: 100%; */
      /* min-width: 500px; */
      /* height: 100%; */
      overflow: hidden;
    }


    :root {
      /* --aspect: 1/1; */
    }

    .btn-numpad {
      aspect-ratio: var(--aspect, 1/1);
      width: 100%;
    }

    .btn-picker {
      aspect-ratio: var(--aspect, 4/1);
      width: 100%;
    }

    .aspect-21 {
      --aspect: 2/1;
    }

    .aspect-43 {
      --aspect: 4/3;
    }

    .hidden {
      display: none;
    }
  </style>
  <script>
    var HashTag = window.location.hash?.substring(1)
    var DebugMode = HashTag.match(/debug/i)
    var TouchMode = 'ontouchstart' in window
    var QueryString = new URLSearchParams(window.location.search)

    function FillData(RefractionRecord) {
      $('[name="by"]').val(RefractionRecord.by)
      $('[name="Purpose"]').val(RefractionRecord.Purpose)
      $('.rx-entry').each((unused, e) => {
        $(e).val(RefractionRecord[e.name])
      })
    }

    // var TestData_2 = {
    //   optometrist: {
    //     name: "Yan Ka Chun",
    //     registration_number: "OP101026"
    //   },
    //   habbitual: {
    //     r: {sph: "-100", cyl: "-075", axis: "175"},
    //     l: {sph: "-300", cyl: "-225", axis: "013"}
    //   },
    //   full: {
    //     r: {sph: "-100", cyl: "-075", axis: "175", add: "250", pd: "30.5", va: "0.9"},
    //     l: {sph: "-300", cyl: "-225", axis: "013", pd: "31", va: "0.8-"}
    //   },
    //   adjusted: {
    //     purpose: "Near",
    //     r: {sph: "+150", cyl: "-075", axis: "175", pd: "29.5"},
    //     l: {sph: "-050", cyl: "-225", axis: "013", pd: "30"}
    //   }
    // };

    var TestData_3 = {
      by: "Yan Ka Chun ( OP101026 )",
      OR_Sphere_R: "-100",
      OR_Cylinder_R: "-200",
      OR_Axis_R: "175",
      OR_PD_R: "30.5",
      OR_Prism_R: "20",
      OR_ADD_R: "250",
      OR_VA_R: "0.8+",
      OR_Sphere_L: "+075",
      OR_Cylinder_L: "-125",
      OR_Axis_L: "091",
      OR_PD_L: "31.5",
      OR_Prism_L: "20",
      OR_ADD_L: "250",
      OR_VA_L: "0.9",
      F_Sphere_R: "-125",
      F_Cylinder_R: "-225",
      F_Axis_R: "175",
      F_PD_R: "31",
      // F_Prism_R: "",
      F_ADD_R: "250",
      F_VA_R: "0.9+",
      F_Sphere_L: "+050",
      F_Cylinder_L: "-150",
      F_Axis_L: "090",
      F_PD_L: "31",
      // F_Prism_L: "",
      F_ADD_L: "250",
      F_VA_L: "0.9+",
      Purpose: "Progressive",
      // Sphere_R: "",
      // Cylinder_R: "",
      // Axis_R: "",
      // PD_R: "",
      // Prism_R: "",
      // ADD_R: "",
      // VA_R: "",
      // Sphere_L: "",
      // Cylinder_L: "",
      // Axis_L: "",
      // PD_L: "",
      // Prism_L: "",
      // ADD_L: "",
      VA_L: "1.0"
    }

    function GatherData() {
      var Refraction = {}
      $('.rx-entry').each((i, e) => {
        if (e.value) Refraction[e.name] = e.value
      })
      return Refraction
    }

    function SaveData() {
      console.log('starts saving')
      $('#save-processing-indicator').removeClass('hidden')

      $.ajax("https://samyankc.site/cgi/add_json", {
        contentType: 'application/json',
        type: 'POST',
        data: JSON.stringify({
          identifier_name: "refraction_id",
          custom_reference: $('#customer_phone_input').val(),
          value: GatherData()
        })
      }).then((response) => {
        $('#save-processing-indicator').addClass('hidden')
        $('#refraction_id_input').val(response.refraction_id);
        $('#refraction_id_in_modal').html(response.refraction_id);
        $('#save-complete-modal')[0].showModal()
      });
    }


    function SendTestData() {
      $.ajax("https://samyankc.site/cgi/add_json", {
        contentType: 'application/json',
        type: 'POST',
        data: JSON.stringify({
          identifier_name: "refraction_id",
          custom_reference: "98765432",
          value: TestData_3
        })
      }).then((response) => {
        $('#refraction_id_input').val(response.refraction_id);
      });
    }

    function LoadData() {
      $.ajax("https://samyankc.site/cgi/load_json", {
        type: 'GET',
        data: {
          refraction_id: $('#refraction_id_input').val(),
          custom_reference: $('#customer_phone_input').val()
        }
      }).then(FillData);
    }

    var FocusedCell;

    function SwitchInputPanel() {
      function StripDecorator(FullName) {
        var Fragment = FullName.split('_')
        if (Fragment.length < 2) return Fragment[0]
        return Fragment.at(-2)
      }

      var ActiveInputPanel = '.standard-numpad'
      switch (StripDecorator(FocusedCell.name)) {
        case 'by': ActiveInputPanel = '.optom-picker'; break
        case 'VA': ActiveInputPanel = '.va-picker'; break
        case 'Purpose': ActiveInputPanel = '.purpose-picker'; break
      }
      $('.input-panel').addClass('hidden')
      $(ActiveInputPanel).removeClass('hidden')

    }

    function UpdateNumpadDisplay() {
      $('#numpad-display-panel').val(FocusedCell.value)
    }

    function SwitchFocus(Element) {
      FocusedCell = Element
      $('#CurrentFocus').html(FocusedCell.name)
      SwitchInputPanel()
      UpdateNumpadDisplay()
    }

    function Focusing(NameFragment) {
      // if (!FocusedCell) return false
      return FocusedCell?.name.includes(NameFragment)
    }

    function CheckThenInvoke(Func, ...Arg) {
      $('#LastNumpadKey').html(Arg[0] ?? 'N/A')
      if (!FocusedCell || !Func) return
      Func(...Arg)
      UpdateNumpadDisplay()
    }

    function AssignValue(NewContent) {
      FocusedCell.value = NewContent
    }

    function AppendValue(Content) {
      AssignValue(FocusedCell.value + Content)
    }

    function PrependValue(Content) {
      AssignValue(Content + FocusedCell.value)
    }

    function EraseBack() {
      if (FocusedCell.value === "") return
      AssignValue(FocusedCell.value.slice(0, -1))
    }

    function ClearCell() {
      AssignValue("")
    }

    function SwitchToPL() {
      if (Focusing('Sphere')) AssignValue("+000")
    }

    function SwitchMinus() {
      if (Focusing('VA')) return AppendValue('-')

      if (Focusing('Sphere') || Focusing('Cylinder')) {
        if (FocusedCell.value === '+000') return
        AssignValue(FocusedCell.value.replace('+', '-'))
        if (!FocusedCell.value.startsWith('-')) PrependValue('-')
      }
    }

    function SwitchPlus() {
      if (Focusing('VA')) return AppendValue('+')

      if (Focusing('Sphere')) {
        AssignValue(FocusedCell.value.replace('-', '+'))
        if (!FocusedCell.value.startsWith('+')) PrependValue('+')
      }
    }

    function ClearAdjustedRx() {
      $('#adjusted_rx_group').find('input').val("")
    }

    function CopyFromFullRx(...FieldNames) {
      for (var Name of FieldNames) {
        for (var Side of ['R', 'L']) {
          $(`input[name=${Name}_${Side}]`).val($(`input[name=F_${Name}_${Side}]`).val())
        }
      }
    }

    function SwitchPurpose(Content) {
      ClearAdjustedRx()
      if (Content.includes('ClearAdjustedRx')) return ClearCell()

      AssignValue(Content)
      // try {
      // Phase 1 Fallthrough Copy
      switch (Content) {
        case '漸進式':
        case 'Record':
        case '雙光':
          CopyFromFullRx('ADD', 'Prism')
        case '遠用':
          CopyFromFullRx('Sphere')
        case 'Mono Vision':
          CopyFromFullRx('PD')
        case '老花 近用':
        case '中距離 睇電腦 打麻雀':
          CopyFromFullRx('Cylinder', 'Axis', 'VA', 'PD')
      }

      // Phase 2 Adjustment

      if (['老花 近用', '中距離 睇電腦 打麻雀'].includes(Content)) {
        // Sphere Adjustment
        for (var Side of ['R', 'L']) {
          var S = parseInt($(`input[name=F_Sphere_${Side}]`).val())
          var A = parseInt($(`input[name=F_ADD_${Side}]`).val())

          if (Content === '中距離 睇電腦 打麻雀') A -= 50

          if (isNaN(A)) A = 0 // return $(`input[name=F_ADD_${Side}]`).focus()

          var Result = (S + A).toString()
          var Sign = Result.startsWith('-') ? '-' : '+';

          Result = Result.match(/\d+/)[0]

          switch (Result.length) {
            case 1: Result = '00' + Result; break
            case 2: Result = '0' + Result; break
          }

          $(`input[name=Sphere_${Side}]`).val(Sign + Result)
        }

        //PD Adjustment
        for (var Side of ['R', 'L']) {
          var P = parseFloat($(`input[name=F_PD_${Side}]`).val()) - 1.0
          // if (isNaN(P)) P = 100.0 // return $(`input[name=F_PD_${Side}]`).focus()
          if (Content === '中距離 睇電腦 打麻雀') P += 0.5
          $(`input[name=PD_${Side}]`).val(isNaN(P) ? "" : P.toString())
        }
      }
      // } catch (err) { }

    }

    window.onload = function () {
      $('#optom_name_input').val(QueryString.get('optom_name'))
      $('.rx-table input').attr("inputmode", "none")
      $('.rx-table input').attr("onfocus", "SwitchFocus(this)")
      $('.btn-numpad').addClass('btn btn-outline-success f-lg')
      $('.btn-picker').addClass('btn btn-outline-success f-lg')
      const TouchTrigger = TouchMode ? 'touchstart' : 'mousedown'
      $('.input-panel button, .input-panel-common button').on(TouchTrigger, e => {
        e.preventDefault();
        FocusedCell?.focus()
        const This = e.target
        const Func = window[This.getAttribute('ontouch')]
        CheckThenInvoke(Func, This.value || This.innerHTML)
      })
      $('.input-panel button, .input-panel-common button').attr("tabIndex", "-1")

      $('input[name*=Sphere_]').on('focusout', e => {
        const This = e.target
        This.value = This.value.replace(/^[\+\-]?p+l[^\d]*$/i, '+000').replaceAll(/[^\d\+\-]+/g, '')
      })

      $('input[name*=Cylinder_]').on('focusout', e => {
        const This = e.target
        This.value = This.value.replaceAll(/[^\d]+/g, '')
        if (This.value === "") return;
        This.value = '-' + This.value
      })

      $('input[name*=Axis_]').on('focusout', e => {
        const This = e.target
        // const Cylinder = $(`input[name=${This.name.replace('Axis', 'Cylinder')}]`)[0]
        // if (Cylinder.value === "") return This.value = ""
        This.value = This.value.replaceAll(/[^\d]+/g, '')
        switch (This.value.length) {
          case 1: This.value = '00' + This.value; break
          case 2: This.value = '0' + This.value; break
        }
      })

      $('input[name*=ADD_]').on('focusout', e => {
        const This = e.target
        This.value = This.value.replaceAll(/[^\d]+/g, '')
      })

      $('input[name*=Prism_]').on('focusout', e => {
        const This = e.target
        This.value = This.value.replaceAll(/[^\d\.]+/g, '')
      })

      $('input[name*=PD_]').on('focusout', e => {
        const This = e.target
        This.value = This.value.replaceAll(/[^\d\.]+/g, '')

      })

      // $('input[name*=_]').on('focusout', e => {
      // })


      if (!DebugMode) $('#Debug_Info_Display').addClass('hidden')

    }
  </script>
</head>

<body>
  <div style="padding-top: 10px;"></div>

  <main class="container-fluid ps-0">
    <div class="row pt-1">

      <div class="col-8 rx-table">
        <div class="row text-end mt-1">
          <label class="col-3 col-form-label text-truncate" for="refraction_id_input">Refraction ID :</label>
          <div class="col-3"><input class="form-control" id="refraction_id_input" type="text" name="refraction_id"></div>

          <label class="col-3 col-form-label text-truncate" for="customer_phone_input">Customer Phone :</label>
          <div class="col-3"><input class="form-control" id="customer_phone_input" type="text" name="customer_phone"></div>
        </div>

        <div class="row text-end">
          <label class="col-3 col-form-label text-truncate" for="optom_name_input">Optometrist :</label>
          <div class="col-6"><input class="rx-entry form-control" id="optom_name_input" type="text" name="by"></div>
          <div class="col"><button class="btn btn-success mt-1 p-2" onclick="LoadData()">Load Record</button></div>
        </div>

        <div class="rx-group-header ps-2 pt-3">Habbitual Rx</div>
        <div id="habbitual_rx_group">
          <div class="row g-2 text-center">
            <div class="col-1"> </div>
            <div class="col">Sph</div>
            <div class="col">Cyl</div>
            <div class="col">Axis</div>
            <div class="col">ADD</div>
            <div class="col">H</div>
            <div class="col">VA</div>
            <div class="col">PD</div>
          </div>
          <div id="habbitual_r" class="row g-2">
            <div class="col-1 col-form-label text-center">R</div>
            <div class="col"><input name="OR_Sphere_R" class="rx-entry rx-entry-sph form-control" type="text" inputmode="none" onfocus="SwitchFocus(this)"></div>
            <div class="col"><input name="OR_Cylinder_R" class="rx-entry rx-entry-cyl form-control" type="text"></div>
            <div class="col"><input name="OR_Axis_R" class="rx-entry rx-entry-axis form-control" type="text"></div>
            <div class="col"><input name="OR_ADD_R" class="rx-entry rx-entry-add form-control" type="text"></div>
            <div class="col"><input name="OR_Prism_R" class="rx-entry rx-entry-h form-control" type="text"></div>
            <div class="col"><input name="OR_VA_R" class="rx-entry rx-entry-va form-control" type="text"></div>
            <div class="col"><input name="OR_PD_R" class="rx-entry rx-entry-pd form-control" type="text"></div>
          </div>
          <div id="habbitual_l" class="row g-2">
            <div class="col-1 col-form-label text-center">L</div>
            <div class="col"><input name="OR_Sphere_L" class="rx-entry rx-entry-sph form-control" type="text"></div>
            <div class="col"><input name="OR_Cylinder_L" class="rx-entry rx-entry-cyl form-control" type="text"></div>
            <div class="col"><input name="OR_Axis_L" class="rx-entry rx-entry-axis form-control" type="text"></div>
            <div class="col"><input name="OR_ADD_L" class="rx-entry rx-entry-add form-control" type="text"></div>
            <div class="col"><input name="OR_Prism_L" class="rx-entry rx-entry-h form-control" type="text"></div>
            <div class="col"><input name="OR_VA_L" class="rx-entry rx-entry-va form-control" type="text"></div>
            <div class="col"><input name="OR_PD_L" class="rx-entry rx-entry-pd form-control" type="text"></div>
          </div>
        </div>

        <div class="rx-group-header ps-2 pt-3">Full Rx</div>
        <div id="full_rx_group">
          <div class="row g-2 text-center">
            <div class="col-1"> </div>
            <div class="col">Sph</div>
            <div class="col">Cyl</div>
            <div class="col">Axis</div>
            <div class="col">ADD</div>
            <div class="col">H</div>
            <div class="col">VA</div>
            <div class="col">PD</div>
          </div>
          <div id="full_r" class="row g-2">
            <div class="col-1 col-form-label text-center">R</div>
            <div class="col"><input name="F_Sphere_R" class="rx-entry rx-entry-sph form-control" type="text"></div>
            <div class="col"><input name="F_Cylinder_R" class="rx-entry rx-entry-cyl form-control" type="text"></div>
            <div class="col"><input name="F_Axis_R" class="rx-entry rx-entry-axis form-control" type="text"></div>
            <div class="col"><input name="F_ADD_R" class="rx-entry rx-entry-add form-control" type="text"></div>
            <div class="col"><input name="F_Prism_R" class="rx-entry rx-entry-h form-control" type="text"></div>
            <div class="col"><input name="F_VA_R" class="rx-entry rx-entry-va form-control" type="text"></div>
            <div class="col"><input name="F_PD_R" class="rx-entry rx-entry-pd form-control" type="text"></div>
          </div>
          <div id="full_l" class="row g-2">
            <div class="col-1 col-form-label text-center">L</div>
            <div class="col"><input name="F_Sphere_L" class="rx-entry rx-entry-sph form-control" type="text"></div>
            <div class="col"><input name="F_Cylinder_L" class="rx-entry rx-entry-cyl form-control" type="text"></div>
            <div class="col"><input name="F_Axis_L" class="rx-entry rx-entry-axis form-control" type="text"></div>
            <div class="col"><input name="F_ADD_L" class="rx-entry rx-entry-add form-control" type="text"></div>
            <div class="col"><input name="F_Prism_L" class="rx-entry rx-entry-h form-control" type="text"></div>
            <div class="col"><input name="F_VA_L" class="rx-entry rx-entry-va form-control" type="text"></div>
            <div class="col"><input name="F_PD_L" class="rx-entry rx-entry-pd form-control" type="text"></div>
          </div>
        </div>

        <div class="row ps-2 pt-3">
          <div class="col-4 mt-auto mb-0 pb-0">
            <div class="row">
              <div class="col-8 rx-group-header">Adjusted Rx</div>
              <label class="col rx-group-header text-end" for="refraction_purpose_input">用途:</label>
            </div>
          </div>
          <div class="col">
            <div class="row">
              <!-- <label class="col-3 col-form-label text-truncate text-end f-lg" for="refraction_purpose_input">用途:</label> -->
              <div class="col-8"><input id="refraction_purpose_input" name="Purpose" class="rx-entry rx-entry-purpose form-control text-center"></div>
              <div class="col"><button class="btn btn-success h-100" tabIndex="-1" onclick="SendTestData()">Test Data</button></div>
            </div>
          </div>
        </div>

        <div id="adjusted_rx_group">

          <div class="row g-2 text-center">
            <div class="col-1"> </div>
            <div class="col">Sph</div>
            <div class="col">Cyl</div>
            <div class="col">Axis</div>
            <div class="col">ADD</div>
            <div class="col">H</div>
            <div class="col">VA</div>
            <div class="col">PD</div>
          </div>
          <div id="adjusted_r" class="row g-2">
            <div class="col-1 col-form-label text-center">R</div>
            <div class="col"><input name="Sphere_R" class="rx-entry rx-entry-sph form-control" type="text"></div>
            <div class="col"><input name="Cylinder_R" class="rx-entry rx-entry-cyl form-control" type="text"></div>
            <div class="col"><input name="Axis_R" class="rx-entry rx-entry-axis form-control" type="text"></div>
            <div class="col"><input name="ADD_R" class="rx-entry rx-entry-add form-control" type="text"></div>
            <div class="col"><input name="Prism_R" class="rx-entry rx-entry-h form-control" type="text"></div>
            <div class="col"><input name="VA_R" class="rx-entry rx-entry-va form-control" type="text"></div>
            <div class="col"><input name="PD_R" class="rx-entry rx-entry-pd form-control" type="text"></div>
          </div>
          <div id="adjusted_l" class="row g-2">
            <div class="col-1 col-form-label text-center">L</div>
            <div class="col"><input name="Sphere_L" class="rx-entry rx-entry-sph form-control" type="text"></div>
            <div class="col"><input name="Cylinder_L" class="rx-entry rx-entry-cyl form-control" type="text"></div>
            <div class="col"><input name="Axis_L" class="rx-entry rx-entry-axis form-control" type="text"></div>
            <div class="col"><input name="ADD_L" class="rx-entry rx-entry-add form-control" type="text"></div>
            <div class="col"><input name="Prism_L" class="rx-entry rx-entry-h form-control" type="text"></div>
            <div class="col"><input name="VA_L" class="rx-entry rx-entry-va form-control" type="text"></div>
            <div class="col"><input name="PD_L" class="rx-entry rx-entry-pd form-control" type="text"></div>
          </div>
        </div>

        <div class="pb-4"></div>



      </div>

      <div class="col-4">

        <div id="Debug_Info_Display" class="mb-3">
          <table>
            <tr>
              <td> Element in Focus | </td>
              <td>
                <div id="CurrentFocus"></div>
              </td>
            </tr>
            <tr>
              <td> Last Numpad Key | </td>
              <td>
                <div id="LastNumpadKey"></div>
              </td>
            </tr>
          </table>
        </div>

        <div class="row row-cols-4 g-0 text-center input-panel-common">

          <div class="col-6"><button class="btn-numpad" style="--aspect:2/1;" ontouch="ClearCell">Clear</button></div>
          <!-- <div class="col-6"><button class="btn-numpad" style="--aspect:2/1;" ontouch="NextCell">Next</button></div> -->
          <div class="col-6">
            <button class="btn-numpad" style="--aspect:2/1;" ontouch="SaveData">
              Save<div id="save-processing-indicator" class="spinner-border text-success hidden"></div>
            </button>
          </div>

          <div class="col-12 pb-3"></div>
        </div>
        <div class="row row-cols-4 g-0 text-center input-panel standard-numpad va-picker">

          <div class="col-10"><input class="btn-numpad f-lg" style="--aspect:15/3;" disabled type="text" id="numpad-display-panel"></div>
          <div class="col-2"><button class="btn-numpad f-lg" style="--aspect:3/3;" ontouch="EraseBack">&#129092;</button></div>

          <div class="col-4"><button class="btn-numpad f-lg" style="--aspect:3/2;" ontouch="SwitchMinus">-</button></div>
          <div class="col-4"><button class="btn-numpad f-lg" style="--aspect:3/2;" ontouch="SwitchToPL">PL</button></div>
          <div class="col-4"><button class="btn-numpad f-lg" style="--aspect:3/2;" ontouch="SwitchPlus">+</button></div>

          <div class="col"><button class="btn-numpad" ontouch="AppendValue">7</button></div>
          <div class="col"><button class="btn-numpad" ontouch="AppendValue">8</button></div>
          <div class="col"><button class="btn-numpad" ontouch="AppendValue">9</button></div>

          <div class="col"><button class="btn-numpad" ontouch="AppendValue">75</button></div>

          <div class="col"><button class="btn-numpad" ontouch="AppendValue">4</button></div>
          <div class="col"><button class="btn-numpad" ontouch="AppendValue">5</button></div>
          <div class="col"><button class="btn-numpad" ontouch="AppendValue">6</button></div>

          <div class="col"><button class="btn-numpad" ontouch="AppendValue">50</button></div>

          <div class="col"><button class="btn-numpad" ontouch="AppendValue">1</button></div>
          <div class="col"><button class="btn-numpad" ontouch="AppendValue">2</button></div>
          <div class="col"><button class="btn-numpad" ontouch="AppendValue">3</button></div>

          <div class="col"><button class="btn-numpad" ontouch="AppendValue">25</button></div>

          <div class="col-6"><button class="btn-numpad aspect-21" ontouch="AppendValue">0</button></div>
          <div class="col"><button class="btn-numpad" ontouch="AppendValue">.</button></div>
          <div class="col"><button class="btn-numpad" ontouch="AppendValue">00</button></div>
        </div>

        <div class="row g-0 text-center mt-3 input-panel va-picker hidden">
          <div class="col-6"><button class="btn-picker aspect-21" ontouch="AssignValue">FC</button></div>
          <div class="col-6"><button class="btn-picker aspect-21" ontouch="AssignValue">BAL</button></div>
          <div class="col-6"><button class="btn-picker aspect-21" ontouch="AssignValue">LP</button></div>
          <div class="col-6"><button class="btn-picker aspect-21" ontouch="AssignValue">NLP</button></div>
        </div>

        <div class="row g-2 text-center input-panel optom-picker hidden">
          <div class="col-12"><button class="btn-picker" ontouch="AssignValue" value="Provided / Dr Rx">客人提供度數<br>或 醫生處方</button></div>
          <div class="col-12"><button class="btn-picker" ontouch="AssignValue" value="Optom #05 ( OP123456 )">Optom #01<br>( OP123456 )</button></div>
          <div class="col-12"><button class="btn-picker" ontouch="AssignValue" value="Optom #05 ( OP223456 )">Optom #02<br>( OP223456 )</button></div>
          <div class="col-12"><button class="btn-picker" ontouch="AssignValue" value="Optom #05 ( OP323456 )">Optom #03<br>( OP323456 )</button></div>
          <div class="col-12"><button class="btn-picker" ontouch="AssignValue" value="Optom #05 ( OP423456 )">Optom #04<br>( OP423456 )</button></div>
          <div class="col-12"><button class="btn-picker" ontouch="AssignValue" value="Optom #05 ( OP523456 )">Optom #05<br>( OP523456 )</button></div>
        </div>

        <div class="row g-0 text-center input-panel purpose-picker hidden">
          <div class="col-6"><button class="btn-picker aspect-43" ontouch="SwitchPurpose" value="遠用">遠用</button></div>
          <div class="col-6"><button class="btn-picker aspect-43" ontouch="SwitchPurpose" value="老花 近用">近用</button></div>
          <div class="col-12"><button class="btn-picker" ontouch="SwitchPurpose" value="中距離 睇電腦 打麻雀">中距離</button></div>
          <div class="col-6"><button class="btn-picker aspect-43" ontouch="SwitchPurpose" value="漸進式">漸進式</button></div>
          <div class="col-6"><button class="btn-picker aspect-43" ontouch="SwitchPurpose" value="雙光">雙光</button></div>
          <div class="col-6"><button class="btn-picker aspect-43" ontouch="SwitchPurpose">Mono Vision</button></div>
          <div class="col-6"><button class="btn-picker aspect-43" ontouch="SwitchPurpose">Contact Lens</button></div>
          <div class="col-12 pt-2"><button class="btn-picker" ontouch="SwitchPurpose">Record</button></div>
          <div class="col-12 pt-2"><button class="btn-picker" ontouch="SwitchPurpose" value="ClearAdjustedRx">Clear Adjusted Rx</button></div>
        </div>
      </div>

    </div>

  </main>

  <dialog id="save-complete-modal" class="w-50" tabindex="-1">

    <div class="modal-header">
      <h1 class="modal-title">New Refraction ID</h1>
    </div>
    <div class="modal-body">
      <h1 id="refraction_id_in_modal" class="modal-title text-center">....</h1>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-secondary" onclick="$('#save-complete-modal')[0].close()">Close</button>
    </div>

  </dialog>


</body>

</html>
